<app-ata-modify-header

  [project]="project"
  (emitValueToggleProject)="containerHeightToggle($event)"

></app-ata-modify-header>
<div class="distanceWrapper">

<div class="" style="margin-top: 30px;">
      <div class="tab-navigation mt-5">
        <div class="nav-tabs tab-navigation ">
          <ul class="nav nav-tabs nav-pills">
            <li
              class="nav-item approveItem"
            >
            <a class="nav-link active"
            [ngClass]="{ active: selectedTab == 0 }"
            [ngStyle]="{'padding': selectedTab != 0 ? '0px 25px 2px 15px' : ''}"
            (click)="canYouChangeSelectedTab(0)" id="approveItem" style="z-index:5">
            {{ renderText()| translate }} <div [ngClass]="{ 'hide-bottom-box-shadow': selectedTab == 0, 'bottom-shadow-button': selectedTab !== 0 }"></div></a>

            </li>
            <li
              class="nav-item align-l"
              *ngIf="type == 'external'"

            >
            <a  class="nav-link attest " [ngClass]="{ active: selectedTab == 2 }"
            (click)="canYouChangeSelectedTab(2)" style="z-index: 4; margin-left: -19px;">
            {{ "Email Logs" | translate }}<div [ngClass]="{ 'hide-bottom-box-shadow': selectedTab == 2, 'bottom-shadow-button': selectedTab !== 2 }"></div></a>

            </li>
            <li class="nav-item align-l">
          <div class="warningSign" *ngIf="ata.deviationComments > 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14">
              <g id="Group_4021" data-name="Group 4021" transform="translate(0.389 -0.485)">
                <g id="Anteckning_information_låst" data-name="Anteckning/information låst" transform="translate(0 0)">
                  <g id="Group_325" data-name="Group 325" transform="translate(0 0)">
                    <ellipse id="Ellipse_658" data-name="Ellipse 658" cx="7.5" cy="7" rx="7.5" ry="7" transform="translate(-0.389 0.485)" fill="#b63418"/>
                  </g>
                  <g id="Group_346" data-name="Group 346" transform="translate(5.947 1.709)">
                    <path id="Path_784" data-name="Path 784" d="M33.07,12.225a1.067,1.067,0,0,0,.788-.312,1.048,1.048,0,0,0,.312-.773,1.067,1.067,0,0,0-.312-.788,1.049,1.049,0,0,0-.773-.312,1.037,1.037,0,0,0-.773.32,1.075,1.075,0,0,0-.312.78,1.049,1.049,0,0,0,.312.773A1.031,1.031,0,0,0,33.07,12.225Z" transform="translate(-32 -10.04)" fill="#fff"/>
                    <path id="Path_785" data-name="Path 785" d="M34.666,26.974a.445.445,0,0,0-.327-.134h-.8a.457.457,0,0,0-.461.461v6.6a.457.457,0,0,0,.461.461h.8A.457.457,0,0,0,34.8,33.9V27.3A.444.444,0,0,0,34.666,26.974Z" transform="translate(-32.868 -23.417)" fill="#fff"/>
                  </g>
                </g>
              </g>
            </svg>
          </div>


          <a style="margin-bottom:-5px; z-index: 3; margin-left: -16px;" class="nav-link attest " [ngClass]="{ active: selectedTab == 3 } "
          (click)="canYouChangeSelectedTab(3)" >
          {{ "Comment" | translate }}<div [ngClass]="{ 'hide-bottom-box-shadow': selectedTab == 3, 'bottom-shadow-button': selectedTab !== 3 }"></div></a>

          </li>
          </ul>
        </div>
      </div>
      <div class="deviationWrapper" [ngStyle]="{'margin-top': selectedTab == 3? '3px': '0px', 'height':setHeight.height}">
        <div #scrollContainer class="ata-border  shadow-top-div blu-scroll" [ngStyle]="{'height':setHeight.height}">
          <div [hidden]="selectedTab != 0" style="position: relative;z-index: 9;">
            <div class="blue-top-nav">
              <div  class="blue-top-nav-text" #blueTopNavText> {{ ataTypeName | translate }} </div>

              <div class="row wrap">
                <div class="column-container">
                  <div class="flex-center-all">
                    <app-hex-status-icon [iconColor]="statusAndColor.color " ></app-hex-status-icon>
                    <span [ngStyle]="{'color': statusAndColor.color }" class="statusName">{{statusAndColor.StatusName | translate}}</span>
                  </div>
                  <div class="line-between" [ngStyle]="{'margin-left': statusAndColor.StatusName=='Sent'?'50px': bluTopNavTextHeight + 'px'}"></div>
                  <div class="icon-txt" style="white-space: nowrap;">
                    <p>{{ 'U - ' | translate }} <span [title]="createForm.get('Title').value">{{ata_messages[this.selectedDeviation].AtaNumber}}: {{ slicedTitle() }}</span> </p>
                  </div>
                </div>

                <div class="options-div2">
                  <!-- <div class="link-component-container">
                    <app-ata-link [relations]="ata.ata_relations"></app-ata-link>
                    <app-ata-link-old *ngIf="!ata.ata_relations.length" [ata]="ata" type="Deviation" parent="deviation"></app-ata-link-old>
                    <app-ata-link-old *ngIf="!ata.ata_relations.length" [ata]="ata" type="ATA" parent="deviation"></app-ata-link-old>
                  </div> -->

                  <div>

                    <div class="button-container" *ngIf="allowEditDeviation() && (showSend || statusChangable || deviationTransformable)">

                      <!-- Dropdown SEND/PRINT DEVIATION-->
                      <div class="input-wrapper4" *ngIf="showSend">
                        <app-send-print-dropdown-ut
                        *ngIf="type == 'external'"
                        [type]="type"
                        [contacts]="contacts"
                        [activeCompanyWorkers]="allContacts"
                        [Print]="'Print' | translate"
                        [Send]="'Send' | translate"
                        [accepted]="ata_messages[selectedDeviation].accepted"
                        [EmailSent]="ata_messages[selectedDeviation].EmailSent"
                        (buttonNameSummaryEvent)="buttonNameSummary($event)"
                        (sendDeviationMessageEvent)="sendDeviationByType($event)"
                        (runParentFunction)="runParentFunction($event)"
                        location="top-send"
                        [disableSelect]="disabledInput"
                        >

                        </app-send-print-dropdown-ut>

                        <app-send-print-dropdown-ut
                        *ngIf="type == 'internal'"
                        [type]="type"
                        [contacts] = "contacts"
                        [activeCompanyWorkers] = "activeCompanyWorkers"
                        [Print]="'Print' | translate"
                        [Send]="'Send' | translate"
                        (buttonNameSummaryEvent)="buttonNameSummary($event)"
                        (sendDeviationMessageEvent)="sendDeviationByType($event)"
                        (runParentFunction)="runParentFunction($event)"
                        location="top-send"
                        [disableSelect]="disabledInput"
                        >

                        </app-send-print-dropdown-ut>
                      </div>
                      <!-- End Dropdown SEND/PRINT DEVIATION -->

                      <!--Old Dropdown SEND/PRINT DEVIATION-->
                      <!--<button

                        *ngIf="showSend"
                        [class.button-open]="buttonToggle"
                        class="btn ata-btn-summary mr-4 d-flex"
                        (click)="buttonNameSummary(worker)"

                      >
                        <span class="" style="text-align: left;">{{'TSC_SEND_PRINT'|translate}}</span>
                        <svg class="pdfIcon"  [ngClass]="buttonToggle == false ? '': 'd-none'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15" height="8" viewBox="0 0 15 8">
                          <defs>
                            <clipPath id="clip-path">
                              <path id="Path_758" data-name="Path 758" d="M0,.274H15v-8H0Z" transform="translate(0 7.726)" fill="#82a7e2"/>
                            </clipPath>
                          </defs>
                          <g id="Group_305" data-name="Group 305" clip-path="url(#clip-path)">
                            <g id="Group_304" data-name="Group 304" transform="translate(0 0)">
                              <path id="Path_757" data-name="Path 757" d="M.035.041,6.668,6.6a.872.872,0,0,0,.678.249h.075A.872.872,0,0,0,8.1,6.6L14.695.041a.665.665,0,0,0,.17-.5.52.52,0,0,0-.32-.435l-.226-.124a1.251,1.251,0,0,0-.641-.14.784.784,0,0,0-.565.264L7.384,4.7,1.655-.891a.784.784,0,0,0-.565-.264,1.251,1.251,0,0,0-.641.14L.186-.891a.52.52,0,0,0-.32.435.665.665,0,0,0,.17.5" transform="translate(0.136 1.156)" fill="#82a7e2"/>
                            </g>
                          </g>
                        </svg>
                        <svg style="justify-self: right;" [ngClass]="buttonToggle == true ? '': 'd-none'" class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15" height="8" viewBox="0 0 15 8">
                          <defs>
                            <clipPath id="clip-path">
                              <path id="Path_7582" data-name="Path 7582" d="M0,.274H15v-8H0Z" transform="translate(0 7.726)" fill="#fff"/>
                            </clipPath>
                          </defs>
                          <g id="Group_306" data-name="Group 306" transform="translate(15 8) rotate(180)">
                            <g id="Group_305" data-name="Group 305" clip-path="url(#clip-path)">
                              <g id="Group_304" data-name="Group 304" transform="translate(0 0)">
                                <path id="Path_7572" data-name="Path 7572" d="M.035.041,6.668,6.6a.872.872,0,0,0,.678.249h.075A.872.872,0,0,0,8.1,6.6L14.695.041a.665.665,0,0,0,.17-.5.52.52,0,0,0-.32-.435l-.226-.124a1.251,1.251,0,0,0-.641-.14.784.784,0,0,0-.565.264L7.384,4.7,1.655-.891a.784.784,0,0,0-.565-.264,1.251,1.251,0,0,0-.641.14L.186-.891a.52.52,0,0,0-.32.435.665.665,0,0,0,.17.5" transform="translate(0.136 1.156)" fill="#fff"/>
                              </g>
                            </g>
                          </g>
                        </svg>

                      </button>-->


                     <!-- <div *ngIf="buttonToggle" class="toggle-overlay" (click)="buttonToggle = false"></div>
                      <div *ngIf="buttonToggle && showSend"  class="summary-dropdown" [ngClass]="buttonToggle ? '' : 'd-none' " >
                          <app-worker-list

                            *ngIf="type == 'external'"
                            [contacts]="contacts"
                            [activeCompanyWorkers]="allContacts"
                            [type]="type"
                            [EmailSent]="ata_messages[selectedDeviation].EmailSent"
                            (buttonNameSummaryEvent)="buttonNameSummary($event)"
                            (sendDeviationMessageEvent)="sendDeviationByType($event)"
                            (runParentFunction)="runParentFunction($event)"
                            location="top-send"
                            [accepted]="ata_messages[selectedDeviation].accepted"

                          >
                          </app-worker-list>
                          <app-worker-list

                            *ngIf="type == 'internal'"
                            [contacts]="contacts"
                            [activeCompanyWorkers]="activeCompanyWorkers"
                            [type]="type"
                            (buttonNameSummaryEvent)="buttonNameSummary($event)"
                            (sendDeviationMessageEvent)="sendDeviationByType($event)"
                            (runParentFunction)="runParentFunction($event)"
                            location="top-send"

                          >
                          </app-worker-list>
                      </div>-->
                      <!--END Old Dropdown SEND/PRINT DEVIATION-->
                    </div>
                  </div>
                  <div class="button-container" *ngIf="(statusChangable || deviationTransformable) && allowEditDeviation()">
                  <!-- Dropdown DEVIATION STATUS-->
                  <div class="input-wrapper4" >
                    <app-deviation-status
                      [CancelCondition]="statusChangable && ata_messages[selectedDeviation].accepted == 4"
                      [DeclineCondition]="statusChangable"
                      [AcceptCondition]="statusChangable"
                      [AbortCondition]="ata_messages[selectedDeviation].exist_above_deviation_whose_status_has_been_changed && ata_messages[selectedDeviation].accepted != 9"
                      [CreateInternalAtaCondition]="deviationTransformable"
                      [CreateExternalAtaCondition]="deviationTransformable && type == 'external'"
                      [CreateExternalDeviationCondition]="deviationTransformable && type == 'internal'"
                      (Decline)="threeDotsStatusesChange('2')"
                      (Accepted)="threeDotsStatusesChange('0')"
                      (Cancel)="threeDotsStatusesChange('1')"
                      (Abort)="threeDotsStatusesChange('3')"
                      (CIACondition)="createNewAta(0)"
                      (CEACondition)="createNewAta(1)"
                      (CEDCondition)="createNewDeviation()"
                      [disableSelect]="disabledInput"
                    >
                    </app-deviation-status>

                  </div>
                  <!-- END Dropdown DEVIATION STATUS-->
                </div>
                  <!-- <div

                    class="options-div"
                    *ngIf="(statusChangable || deviationTransformable)"
                    (mouseenter)="threeDotsEnter()"
                    (mouseleave)="threeDotsLeave()"

                  >
                   <button
                    type="button"
                    class="btn-options"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                    (click)="optionsDownDiv()"
                    [class.btn-options-collapse]="buttonToggleDots"
                    >
                      <div class="dots-div row">
                        <app-three-dots-svg [color]="arrowUpColor"></app-three-dots-svg>
                        <app-arrow-up-svg [color]="arrowUpColor" *ngIf="!buttonToggleDots"></app-arrow-up-svg>
                        <app-arrow-down-svg color="var(--orange-dark)" *ngIf="buttonToggleDots"></app-arrow-down-svg>
                      </div>
                    </button>
                    <div class="dropdown-menu opt-dd show summary-dropdown-collapse" id="dropdown-the-items" [ngClass]="buttonToggleDots ? '' : 'd-none' ">
                      <div style="border-radius: 4px;">
                        <a

                          *ngIf="statusChangable && ata_messages[selectedDeviation].accepted == 4"
                          class="dropdownList"
                          (click)="threeDotsStatusesChange('1')"

                        >{{ 'TSC_CANCEL_FLOW' | translate }}</a>
                        <a  *ngIf="statusChangable" class="dropdownList" (click)="threeDotsStatusesChange('0')">
                          {{ 'Accept' | translate }}
                        </a>
                        <a *ngIf="statusChangable" class="dropdownList" (click)="threeDotsStatusesChange('2')">
                          {{ 'Decline' | translate }}
                        </a>
                        <a  *ngIf="deviationTransformable" class="dropdownList" (click)="createNewAta(0)">
                          {{ 'Create Internal Ata' | translate }}
                        </a>
                        <a  *ngIf="deviationTransformable && type == 'external'" class="dropdownList" (click)="createNewAta(1)">
                          {{ 'Create External Ata' | translate }}
                        </a>
                        <a  *ngIf="deviationTransformable && type == 'internal'" class="dropdownList" (click)="createNewDeviation()">
                          {{ 'Create External Deviation' | translate }}
                        </a>
                      </div>
                    </div>
                  </div> --><!--kRAJ STARE KOMPONENTE-->
                  <div *ngIf="buttonToggleDots" class="toggle-overlay" (click)="buttonToggleDots = false; threeDotsLeave()"></div>
                </div>
              </div>
            </div>
            <div
              class="tab-pane fade show active"
              id="home"
              role="tabpanel"
              aria-labelledby="home-tab"
            >
              <div
                class="box-message"
                *ngIf="disabledInput && ata.AtaTable != 'ata_become_external' && allowEditDeviation()"
              >
                <h5>{{ "Editing by" | translate }}: {{ fullName }}</h5>
              </div>
            <form
                style="width: 1024px;"
                id="createForm"
                novalidate
                autocomplete="off"
                [formGroup]="createForm"
                (ngSubmit)="updateDeviation(false, false, true)"
                class="form-content"
                #myform="ngForm"
                (click)="enableUpdate()"
            >
                <div class="form-wrapper">
                  <div class="panel panel-default w-100 bordered shadow-top-div">
                    <fieldset>
                      <div class="deviation-buttons" [ngClass]="ata.ata_relations.length > 0 ? 'ua-buttons' : 'u-buttons'">
                        <div *ngIf="ata.ata_relations.length" style="padding: 0px 5px 0px 0px;">
                          <legend style="height: 30px;margin-top: -8px;padding: 5px 9px 0px 0px;">
                            <app-ata-link [relations]="ata.ata_relations" [type] = "type + ' ' + 'deviation'"></app-ata-link>
                            <app-ata-link-old *ngIf="!ata.ata_relations.length" [ata]="ata" type="Deviation" parent="deviation"></app-ata-link-old>
                            <app-ata-link-old *ngIf="!ata.ata_relations.length" [ata]="ata" type="ATA" parent="deviation"></app-ata-link-old>
                          </legend>
                        </div>

                        <legend style="height: 30px;margin-top: -8px;padding: 5px 9px 0px 9px;" (click)="selectDeviation(index)" [ngStyle]="selectedDeviationStyle(index)" class="w-auto" *ngFor="let ata_message of ata_messages; let index = index;">
                          <div>
                            {{"U - "}}{{ ata_message.AtaNumber }}
                          </div>
                        </legend>
                      </div>
                      <div class="">
                        <div class="">

                          <div class="form-row input-groups">
                            <div class=" heading">
                              <label for="heading" class="required">{{
                                "Heading" | translate
                              }}</label>

                              <input
                                type="text"
                                class="form-control deviation-desc heading fs-18"
                                id="heading"
                                [ngClass]="{
                                  'is-invalid':
                                    (createForm.get('Title').touched ||
                                      myform.submitted) &&
                                    createForm.get('Title').invalid
                                }"
                                placeholder="{{ 'Enter Title' | translate }}"
                                formControlName="Title"
                                [readonly]="disabledInput || disabledByStatus()"
                                maxlength="50"
                              />
                              <div class="small-container">
                                <div>
                                  <span
                                  class="help-block"
                                  *ngIf="
                                    (createForm.get('Title').touched ||
                                      myform.submitted) &&
                                    createForm.get('Title').invalid
                                  "
                                >
                                  <span
                                    *ngIf="createForm.get('Title').errors.required"
                                    class="text-danger"
                                  >
                                    {{ "Enter Heading" | translate }}
                                  </span>
                                  <span
                                    class="text-danger"
                                    *ngIf="createForm.get('Title').errors.maxlength"
                                  >
                                    {{
                                      "Maximum length of characters is" | translate
                                    }}
                                    {{
                                      createForm.get("Title").errors.maxlength
                                        .requiredLength
                                    }}
                                  </span>
                                </span>
                                </div>
                                <small style="opacity: .75;color: white;">{{createForm.get('Title').value?.length}}/50</small>
                              </div>

                            </div>

                            <div class="status">
                              <div class="form-group">
                                <label for="typedev" class="required">{{
                                  "Select deviation type" | translate
                                }}</label>

                             <!--Dropdown Deviation type-->
                              <div class="input-wrapper2" [ngStyle]="{'background-color': this.ata.Status == 0 ? 'white': 'transparent','pointer-events' : this.ata.Status == 0 ? 'auto': 'none'}">
                                <app-simple-select
                                  [ClientItem]= "DeviationTypes"
                                  [defaultValue]="{
                                    id: '4',
                                    Name: 'Kvalitetsändring'
                                  }"
                                  [fontSize]="18"
                                  formControlName="DeviationType"
                                  [width]="302"
                                  [type1]="'DevType'"
                                  [disableSelect]="disabledInput || disabledByStatus()"
                                >
                                </app-simple-select>
                              </div>
                            <!--End Dropdown Deviation type-->
<!--
                                <select
                                  class="status project-nav-select form-control select-property deviation-desc select-arrow fs-18"
                                  id="typedev"
                                  #selectDeviationType
                                  formControlName="DeviationType"
                                  [ngClass]="{
                                    'is-invalid':
                                      (createForm.get('DeviationType').touched ||
                                        myform.submitted) &&
                                      createForm.get('DeviationType').invalid
                                  }"
                                >
                                  <option
                                    *ngFor="let type of DeviationTypes; let index = index"
                                    value="{{ type.id }}"
                                    [id]="'optiondev' + index"
                                  >
                                    {{ type.Name }}
                                  </option>
                                </select>
-->
                                <span
                                  class="help-block"
                                  *ngIf="
                                    (createForm.get('DeviationType').touched ||
                                      myform.submitted) &&
                                    createForm.get('DeviationType').invalid
                                  "
                                >
                                  <span class="text-danger">
                                    {{
                                      "Please select type deviation" | translate
                                    }}
                                  </span>
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="form-row input-groups">
                            <div class="status">
                              <div class="form-group projects-date">
                                <label for="startDate" class="required">{{
                                  "Start Date" | translate
                                }}</label>
                                <div class="input-group date">
                                  <div class="input-group-prepend">
                                    <span
                                      class="input-group-text"
                                      id="basic-addon1"
                                      ><i class="material-icons"
                                        >calendar_today</i
                                      ></span
                                    >
                                  </div>
                                  <input
                                    (keydown)="$event.preventDefault()"
                                    id="startDate"
                                    autocomplete="off"
                                    type="text"
                                    [ngClass]="{
                                      'is-invalid':
                                        (createForm.get('StartDate').touched ||
                                          myform.submitted) &&
                                        createForm.get('StartDate').invalid,

                                        'is-declined' : disabledByStatus()
                                    }"
                                    class="form-control project-date status fs-18"
                                    aria-describedby="basic-addon1"
                                    placeholder="{{
                                      'Choose Start Date' | translate
                                    }}"
                                    formControlName="StartDate"
                                    #startDate
                                    [readonly]="disabledInput"
                                  />
                                </div>
                                <span
                                  class="help-block"
                                  *ngIf="
                                    (createForm.get('StartDate').touched ||
                                      myform.submitted) &&
                                    createForm.get('StartDate').invalid
                                  "
                                >
                                  <span class="text-danger">
                                    {{ "Please enter start date" | translate }}
                                  </span>
                                </span>
                              </div>
                            </div>
                            <div class="status">
                              <div class="form-group projects-date">
                                <label for="dueDate" class="required">{{
                                  "Due Date" | translate
                                }}</label>
                                <div class="input-group date">
                                  <div class="pominalse"  *ngIf="ata_messages[selectedDeviation].accepted == 4 && type === 'external' && allowEditDeviation()">
                                    <div>
                                      <div style="display: flex;gap: 5px;" (click)="pominalseCheck()">
                                      <img src="/assets/img/modify-ata/check-orange.svg" *ngIf="reminderCheckbox">
                                      <img src="/assets/img/modify-ata/uncheck.svg" *ngIf="!reminderCheckbox">
                                        <div style="text-transform: uppercase;" [ngStyle]="{'color': pominalse? 'var(--orange-dark)' : ''}">{{"Reminder" | translate}}</div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="input-group-prepend">
                                    <span
                                      class="input-group-text"
                                      id="basic-addon1"
                                      ><i class="material-icons"
                                        >calendar_today</i
                                      ></span
                                    >
                                  </div>
                                  <input
                                    (keydown)="$event.preventDefault()"
                                    id="dueDate"
                                    autocomplete="off"
                                    type="text"
                                    [ngClass]="{
                                      'is-invalid':
                                        (createForm.get('DueDate').touched ||
                                          myform.submitted) &&
                                        createForm.get('DueDate').invalid,
                                        'is-declined' : disabledByStatus() && !reminderCheckbox
                                    }"
                                    class="form-control project-date status fs-18"
                                    aria-describedby="basic-addon1"
                                    placeholder="{{
                                      'Choose Due Date' | translate
                                    }}"
                                    formControlName="DueDate"
                                    #selectedDate
                                    [readonly]="disabledInput"
                                  />
                                </div>
                                <span
                                  class="help-block"
                                  *ngIf="
                                    (createForm.get('DueDate').touched ||
                                      myform.submitted) &&
                                    createForm.get('DueDate').invalid
                                  "
                                >
                                  <span class="text-danger">
                                    {{ "Please enter start date" | translate }}
                                  </span>
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>

                    <div

                      *ngIf="
                      editAta &&
                      (
                        (ata_messages[this.selectedDeviation].accepted == -1) && ata_messages[this.selectedDeviation].EmailSent == null
                      ) && !disabledInput
                      "
                      class="fake-image-modal-container2"

                    >
                      <app-image-modal
                        (updateAlbums)="updateAlbumsAta($event)"
                        [infoObject]="infoObjectAta"
                        fileType="application/pdf, image/*"
                        [key]="getAlbumKeys()[0]"
                        [clearFiles]="$_clearFiles.asObservable()"
                    ></app-image-modal>
                      </div>
                      <div class="imagesWrapper">
                        <div class="fake-image-modal-container" *ngFor="let albumKey of getAlbumKeys();">
                            <div class="form-group-upload form-group-upload2">
                                <app-file-preview
                                    *ngFor="let file of getAlbumFiles(albumKey, 'images'); let index = index"
                                    type="image"
                                    [file]="file"
                                    [index]="index"
                                    [active]="index"
                                    (openSwiper)="openSwiper(index, getAlbumFiles(albumKey, 'images'), albumKey)"
                                    (removeFile)="toggleAttachment(albumKey, $event, 'images')"
                                    [canRemove]="(ata.Status == 0 && ata_messages[selectedDeviation].accepted == -1 && editAta && userDetails.create_project_Deviation) || (file.Category == '0' && userDetails.create_project_Deviation)"
                                ></app-file-preview>
                                <!-- <app-file-preview
                                    *ngFor="let file of getAlbumFiles(albumKey, 'pdfs'); let index = index"
                                    type="pdf"
                                    [file]="file"
                                    [index]="index"
                                    [active]="index"
                                    (openSwiper)="openSwiper(index, getAlbumFiles(albumKey, 'pdfs'), albumKey)"
                                    [canRemove]="(ata.Status == 0 && ata_messages[selectedDeviation].accepted == -1 && editAta) || file.Category == '0'"
                                    (removeFile)="toggleAttachment(albumKey, $event, 'pdfs')"
                                ></app-file-preview> -->
                                <app-pdfjs-preview
                                  *ngFor="let file of getAlbumFiles(albumKey, 'pdfs'); let index = index"
                                  style="display: flex; cursor: pointer; width: 68px;"
                                  type="pdf"
                                  (click)="openSwiper(index, getAlbumFiles(albumKey, 'pdfs'), albumKey)"
                                  [pdfUrls]="[file['file_path']]"
                                  [deleted]="file.deleted"
                                  [canRemove]="(ata.Status == 0 && ata_messages[selectedDeviation].accepted == -1 && editAta && userDetails.create_project_Deviation) || (file.Category == '0' && userDetails.create_project_Deviation)"
                                  (removeFile)="toggleAttachment(albumKey, $event, 'pdfs')"
                                  [index]="index"
                                  [active]="index"
                                  [width]="68"
                                  [height]="43"
                                  [borderRadius]="'0px 0px 0px 0px'"
                                  [folder]="true"
                                  [showcheckbox]="true"
                                  >
                                </app-pdfjs-preview>
                            </div>
                            <div [innerHTML]="getAlbumDescription(albumKey)"></div>
                        <!--    <div>
                                {{getAlbumDescription(albumKey)}}
                            </div>-->
                        </div>
                      </div>
                    <div>
                    <div class="image-delete-button-container">
                      <button

                      type="button"
                      (click)="removeSelectedDocumentsDeviation($event)"
                      *ngIf="deletedDocumentsDeviation.length > 0 && userDetails.create_project_Deviation"
                      class="btn btn-danger lh09"

                      >
                        <span class="material-icons left-3px top1px posRel">delete</span>
                        <span class="posRel top-5px">{{ "Delete" | translate }}</span>
                      </button>
                    </div>
                  </div>
                      </div>
                    </fieldset>
                  </div>
                </div>
                <div class="form-wrapper">
                  <div class="panel panel-default w-100 bordered shadow-top-div" >
                    <div>
                      <div class="deviation-buttons">
                        <legend (click)="toggleDesMenu()" class="w-auto legendDescription section-tab-description" >
                          <span style="margin-right: 1rem;">{{ "Description" | translate }}</span>
                          <app-arrow-toggle-svg [opened]="desMenuToggle"></app-arrow-toggle-svg>
                        </legend>
                      </div>
                      <div *ngIf="desMenuToggle" class="form-column-wrapper-position form-column2">
                            <div
                              class="form-group  position-textarea"
                              [ngClass]="{
                                'has-error':
                                  (createForm.get('Description').touched ||
                                    createForm.get('Description').dirty) &&
                                  !createForm.get('Description').valid
                              }"
                            >
                              <label for="">{{
                                "Description" | translate
                              }}</label>
                              <textarea

                                matInput
                                cdkTextareaAutosize
                                #autosize="cdkTextareaAutosize"
                                cdkAutosizeMinRows="1"
                                cdkAutosizeMaxRows="5"
                                type="text"
                                class="form-control blu-scroll new-textarea"
                                id="description"
                                placeholder="{{
                                  'Enter Description' | translate
                                }}"
                                formControlName="Description"
                                [readonly]="disabledInput || disabledByStatus()"
                                maxlength="500"

                              ></textarea>
                              <small style="opacity: .75">{{ getInputLength('Description') }}/500</small>
                              <span
                                class="help-block"
                                *ngIf="
                                  ((createForm.get('Description').touched ||
                                    createForm.get('Description').dirty) &&
                                    createForm.get('Description').errors) ||
                                  (createForm
                                    .get('Description')
                                    .hasError('required') &&
                                    myform.submitted)
                                "
                              >
                                <span
                                  *ngIf="
                                    createForm.get('Description').errors.required
                                  "
                                  class="text-danger"
                                >
                                  {{ "Enter Description" | translate }}.
                                </span>
                              </span>
                            </div>
                          </div>
                          <div *ngIf="desMenuToggle" class="form-column2">
                            <div
                              class="form-group  position-textarea"
                              [ngClass]="{
                                'has-error':
                                  (createForm.get('Reason').touched ||
                                    createForm.get('Reason').dirty) &&
                                  !createForm.get('Reason').valid
                              }"
                            >
                              <label for="reason">{{
                                "Reason" | translate
                              }}</label>
                              <textarea
                                matInput
                                cdkTextareaAutosize
                                #autosize="cdkTextareaAutosize"
                                cdkAutosizeMinRows="1"
                                cdkAutosizeMaxRows="5"
                                type="text"
                                class="form-control blu-scroll new-textarea"
                                id="reason"
                                placeholder="{{ 'Enter Reason' | translate }}"
                                formControlName="Reason"
                                [readonly]="disabledInput || disabledByStatus()"
                                maxlength="500"
                              ></textarea>
                              <small style="opacity: .75">{{ getInputLength('Reason') }}/500</small>
                              <span
                                class="help-block"
                                *ngIf="
                                  ((createForm.get('Reason').touched ||
                                    createForm.get('Reason').dirty) &&
                                    createForm.get('Reason').errors) ||
                                  (createForm
                                    .get('Reason')
                                    .hasError('required') &&
                                    myform.submitted)
                                "
                              >
                                <span
                                  *ngIf="createForm.get('Reason').errors.required"
                                  class="text-danger"
                                >
                                  {{ "Enter Reason" | translate }}.
                                </span>
                              </span>
                            </div>
                          </div>

                          <div *ngIf="desMenuToggle" class="form-column2">
                            <div class="form-group position-textarea">
                              <label for="state" class="">{{
                                "State" | translate
                              }}</label>
                              <input
                                type="text"
                                class="form-control state-input"
                                id="state"
                                placeholder="{{ 'Enter State' | translate }}"
                                formControlName="State"
                                [ngClass]="{
                                  'is-invalid':
                                    (createForm.get('State').touched ||
                                      myform.submitted) &&
                                    createForm.get('State').invalid
                                }"
                                [readonly]="disabledInput || disabledByStatus()"
                                maxlength="255"
                              />
                              <small style="opacity: .75">{{createForm.get('State').value?.length}}/255</small>
                              <span
                                class="help-block"
                                *ngIf="
                                  (createForm.get('State').touched ||
                                    myform.submitted) &&
                                  createForm.get('State').invalid
                                "
                              >
                                <span
                                  *ngIf="createForm.get('State').errors.required"
                                  class="text-danger"
                                >
                                  {{ "Enter State" | translate }}.
                                </span>
                              </span>
                            </div>
                          </div>

                          <div *ngIf="desMenuToggle" class="form-column2">
                            <div
                              class="form-group position-textarea"
                              [ngClass]="{
                                'has-error':
                                  (createForm.get('Suggestion').touched ||
                                    createForm.get('Suggestion').dirty) &&
                                  !createForm.get('Suggestion').valid
                              }"
                            >
                              <label for="suggestion">{{
                                "Suggestion" | translate
                              }}</label>
                              <textarea
                                matInput
                                cdkTextareaAutosize
                                #autosize="cdkTextareaAutosize"
                                cdkAutosizeMinRows="1"
                                cdkAutosizeMaxRows="5"
                                type="text"
                                class="form-control blu-scroll new-textarea"
                                id="suggestion"
                                placeholder="{{ 'Enter Suggestion' | translate }}"
                                formControlName="Suggestion"
                                [readonly]="disabledInput || disabledByStatus()"
                                maxlength="500"
                              ></textarea>
                              <small style="opacity: .75">{{ getInputLength('Suggestion') }}/500</small>
                              <span
                                class="help-block"
                                *ngIf="
                                  ((createForm.get('Suggestion').touched ||
                                    createForm.get('Suggestion').dirty) &&
                                    createForm.get('Suggestion').errors) ||
                                  (createForm
                                    .get('Suggestion')
                                    .hasError('required') &&
                                    myform.submitted)
                                "
                              >
                                <span
                                  *ngIf="
                                    createForm.get('Suggestion').errors.required
                                  "
                                  class="text-danger"
                                >
                                  {{ "Enter Suggestion" | translate }}.
                                </span>
                              </span>
                            </div>
                          </div>

                        </div>
                    <div>
                    <div style="margin-top: 3rem; margin-left: 50px;" *ngIf="ata.AtaTable != 'ata_become_external' || (ata.AtaTable == 'Ata' && ata.Type == 0)" class="buttons-container">
                      <div>
                        <button
                            type="submit"
                            class="save-button-weon"
                            *ngIf="
                                (allowChangeStatusAndUpdate && editAta && allowEditDeviation()) ||
                                (chooseFile && editAta && allowEditDeviation()) ||
                                (editAta && ata_messages[selectedDeviation].accepted == -1 && allowEditDeviation())
                            "
                            [attr.disabled]="(!createForm.dirty || !createForm.valid) ? true : null"
                        >
                          <div class="button-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="23.5" height="18.548" viewBox="0 0 23.5 18.548">
                              <g id="Skapad_mapp" data-name="Skapad mapp" transform="translate(0.75 0.75)">
                                <path id="Path_754" data-name="Path 754" d="M35.654,21.282l-10.092-.025-1.244-1.263a.782.782,0,0,0-.661-.365H17.3a2.129,2.129,0,0,0-2.306,2.091V35.333a1.345,1.345,0,0,0,1.339,1.344H35.654a1.345,1.345,0,0,0,1.339-1.344V22.625A1.345,1.345,0,0,0,35.654,21.282Z" transform="translate(-14.993 -19.629)" fill="#373b40"/>
                                <ng-container *ngIf="!createForm.dirty || !createForm.valid">
                                    <path id="Path_755" data-name="Path 755" d="M35.654,21.282l-10.092-.025-1.244-1.263a.782.782,0,0,0-.661-.365H17.3a2.129,2.129,0,0,0-2.306,2.091V35.333a1.345,1.345,0,0,0,1.339,1.344H35.654a1.345,1.345,0,0,0,1.339-1.344V22.625A1.345,1.345,0,0,0,35.654,21.282Z" transform="translate(-14.993 -19.629)" fill="none" stroke="#cccccc" stroke-width="1.5" opacity="0.973"/>
                                </ng-container>
                                <ng-container *ngIf="createForm.dirty && createForm.valid">
                                    <path id="Path_755" data-name="Path 755" d="M35.654,21.282l-10.092-.025-1.244-1.263a.782.782,0,0,0-.661-.365H17.3a2.129,2.129,0,0,0-2.306,2.091V35.333a1.345,1.345,0,0,0,1.339,1.344H35.654a1.345,1.345,0,0,0,1.339-1.344V22.625A1.345,1.345,0,0,0,35.654,21.282Z" transform="translate(-14.993 -19.629)" fill="none" stroke="#ff7000" stroke-width="1.5" opacity="0.973"/>
                                </ng-container>
                              </g>
                            </svg>
                          </div>
                          <div>
                            {{ "Save" | translate }}
                          </div>
                        </button>
                      </div>
                      <div>
                        <div *ngIf="allowDelete && ata.Status == 0 && allowEditDeviation()" class="delete-button-weon" (click)="deleteDeviationModalOpen()">
                          <div class="button-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="11" height="16.073" viewBox="0 0 11 16.073">
                              <g id="Group_4075" data-name="Group 4075" transform="translate(0 0)">
                                <path id="Path_800" data-name="Path 800" d="M32.964,16.5a.3.3,0,0,0-.286-.313H29.712v-.749a.3.3,0,0,0-.286-.314h-3.89a.3.3,0,0,0-.286.314v.749H22.259a.3.3,0,0,0-.286.313v.922H32.964Z" transform="translate(-21.973 -15.119)" fill="#fd4444"/>
                                <path id="Path_801" data-name="Path 801" d="M21.973,23.209l1.344,12.638c.034.187.128.282.286.282h7.739c.158,0,.252-.1.286-.282l1.344-12.638Zm2.524,12L23.566,25.7h1.241l.5,9.508Zm3.575,0h-1.3L26.585,25.7H28.23Zm2.27,0h-.808l.5-9.508h1.241Z" transform="translate(-21.973 -20.056)" fill="#fd4444"/>
                              </g>
                            </svg>
                          </div>
                          <div>
                            {{ "Remove" | translate }}
                          </div>
                        </div>
                      </div>
                    </div>
                    <app-client-responses

                      *ngIf="clientResponses.length && type == 'external'"
                      [responses]="clientResponses"
                      [deviationStatus]="createForm.get('Status').value"

                    >
                    </app-client-responses>
                  </div>

                    <app-answer-to-client

                      *ngIf="
                            type == 'external' &&
                            clientResponses.length &&
                            (clientResponses[clientResponses.length - 1].Status == 1) &&
                            !nextDeviationExists && clientResponses[clientResponses.length - 1].Status != 9
                            "
                      [user_email]="userDetails.email"
                      [deviationId]="ata_messages[selectedDeviation].id"
                      [projectId]="project.id"
                      (runParentFunction)="runParentFunction($event)"
                      (onRespondToDeviation)="respondToDeviation($event)"

                    ></app-answer-to-client>

                    <app-deviation-chat

                      *ngIf="type == 'internal' && ata_messages[selectedDeviation]"
                      [activeCompanyWorkers]="activeCompanyWorkers"
                      [user_id]="userDetails.user_id"
                      [user_email]="userDetails.email"
                      [deviationId]="ata_messages[selectedDeviation].id"
                      [ataId]="ataId"
                      [deviationNumber]="ata_messages[selectedDeviation].AtaNumber"
                      [projectCustomName]="project.CustomName"
                      [projectId]="project.id"
                      [Author]="ata_messages[selectedDeviation].Author"
                      [deviationStatus]="ata_messages[selectedDeviation].accepted"
                      [nextDeviationExists]="nextDeviationExists"
                      (runParentFunction)="runParentFunction($event)"
                      (disableForm)="jQueryDisableForm()"
                      (internalDevSent)="internalDevSent()"

                    >
                    </app-deviation-chat>

                  </div>
                </div>

              </form>
            </div>
            <div
              class="tab-pane fade"
              id="profile"
              role="tabpanel"
              aria-labelledby="profile-tab"
            ></div>
            <div
              class="tab-pane fade"
              id="contact"
              role="tabpanel"
              aria-labelledby="contact-tab"
            ></div>
          </div>
          <div *ngIf="selectedTab == 2">
            <!-- <app-email-logs
            [logs]="logs"
          ></app-email-logs> -->
          <email-log
            [logs]="logs"
            [appPart]="'deviation'"
            >
          </email-log>
          </div>
          <div *ngIf="selectedTab == 3">
              <app-comment-section

                content_type="deviation"
                [parentId]="ata.ATAID"

              ></app-comment-section>
          </div>
        </div>
        <div class="thin-red-line-bottom" ></div>
        <div  class="thin-red-line-right" ></div>
      </div>
</div>

<div class="progress-loader" *ngIf="spinner">
  <mat-spinner mode="determinate" [value]="progress"></mat-spinner>
  <div *ngIf="progress > 0" class="progress-percentage">{{progress + "%"}}</div>
</div>
<div
  *ngIf="showAttachmentImage"
  class="card col-12X col-lg-6X mb70"
  id="looksLikeModal"
  (click)="toggleAttachmentImage($event)"
>
  <div class="image-wrapper" *ngIf="!showPdf">
    <span class="rotate-icon-left" (click)="rotateLeft()"
      ><i class="material-icons">rotate_left</i></span
    >
    <span class="rotate-icon" (click)="rotateRight()"
      ><i class="material-icons">rotate_right</i></span
    >
    <span
      class="close-icon-right material-icons"
      (click)="showAttachmentImage = !showAttachmentImage"
      >clear</span>
  </div>
  <div id="image-gallery" *ngIf="!showPdf">
    <div class="image-container"></div>
  </div>
  <iframe
    style="max-height: 85vh; width: 50%; height: 100%"
    [src]="currentAttachmentPdf"
    *ngIf="showPdf"
  ></iframe>
</div>
<!-- <div class="aside" [ngClass]="{ 'aside-show': showPdfPreview }">
  <button type="button" (click)="togglePdfPreview()">
    {{ (showPdfPreview ? "Close Preview" : "Preview") | translate }}
  </button>
  <app-deviation-pdf

    [formValues]="createForm.value"
    [project]="project"
    [nextDeviationNumber]="ata_messages[selectedDeviation].AtaNumber"
    [selectedDeviation]="selectedDeviation"
    [files]="files"
    [uploadedFiles]="ata_messages[selectedDeviation].attachments"
    [generalImage]="generalImage"
    (runParentFunction)="runParentFunction($event)"
    [clientResponses]="clientResponses"


  ></app-deviation-pdf>
</div> -->

<div class="aside" [ngClass]="{ 'aside-show': showPdfPreview }">
  <div class="container-box1">
    <div class="container-preview-icon">
      <!-- Dodaj ikone za printanje, preuzimanje i broj stranica -->
      <div class="icon-container">
        <div class="icon">
        <div class="total-container">
          {{  currentPage }} / {{ totalPage }}
        </div>
      </div>
        <div class="icon" (click)="printDeviation()">
          <svg class="svg-hover" id="Component_268_8" data-name="Component 268 – 8" xmlns="http://www.w3.org/2000/svg" width="21.347" height="19.391" viewBox="0 0 21.347 19.391">
            <g id="Group_4091" data-name="Group 4091">
              <g id="Group_3988" data-name="Group 3988" transform="translate(6.225 5.063)">
                <rect id="Rectangle_15585" data-name="Rectangle 15585" width="8.844" height="1.024" transform="translate(0 2.541)" fill="#fff"/>
                <rect id="Rectangle_15586" data-name="Rectangle 15586" width="8.844" height="1.024" fill="#fff"/>
              </g>
              <path id="Path_1752" data-name="Path 1752" d="M36.228,20.046a1.076,1.076,0,0,0-1.073-1.078h-19.2a1.076,1.076,0,0,0-1.073,1.078v9.159h4.054v.808l8.3,8.345h4.9v-9.1h4.1Zm-19.263,7.4V23.165h1.97v4.278ZM26.883,36.3l-5.9-5.932h5.9Zm1.2.853V29.161H20.135v-6h10.8V37.153Zm6.06-9.658H32.133V23.165h2.011Z" transform="translate(-14.881 -18.968)" fill="#fff"/>
            </g>
          </svg>
        </div>
        <div class="icon" (click)="savePdf()">
          <svg class="svg-hover" id="Component_260_22" data-name="Component 260 – 22" xmlns="http://www.w3.org/2000/svg" width="13.957" height="23.564" viewBox="0 0 13.957 23.564">
            <path id="Path_4767" data-name="Path 4767" d="M28.384,42.891a.311.311,0,0,0,.328-.329v-1.5h.45a3.568,3.568,0,0,0,.912-.1,1.277,1.277,0,0,0,.948-1.341,1.245,1.245,0,0,0-.743-1.28,3.278,3.278,0,0,0-1.147-.147H28.6a.668.668,0,0,0-.738.766v3.6a.305.305,0,0,0,.316.329Zm.328-3.859c0-.014,0-.025,0-.034h.449a1.978,1.978,0,0,1,.718.081c.14.059.269.169.269.566a.544.544,0,0,1-.276.542,1.885,1.885,0,0,1-.676.081h-.486Z" transform="translate(-25.657 -27.46)" fill="#fff"/>
            <path id="Path_4768" data-name="Path 4768" d="M35.685,42.879a3.882,3.882,0,0,0,1.179-.158A2.111,2.111,0,0,0,38.1,40.487c0-1.205-.41-1.936-1.218-2.171a4.006,4.006,0,0,0-1.149-.123h-.525a.666.666,0,0,0-.75.766v3.172a.653.653,0,0,0,.738.748Zm-.372-3.841a.273.273,0,0,1,0-.034h.461a2.139,2.139,0,0,1,.874.127c.4.188.578.606.578,1.357,0,.8-.193,1.247-.625,1.448a2.012,2.012,0,0,1-.809.127h-.477a.251.251,0,0,1,0-.045Z" transform="translate(-29.153 -27.459)" fill="#fff"/>
            <path id="Path_4769" data-name="Path 4769" d="M43,39.01h1.636a.3.3,0,0,0,.328-.311V38.51a.3.3,0,0,0-.328-.317H42.9c-.5,0-.75.255-.75.778v3.591a.3.3,0,0,0,.316.329h.217A.308.308,0,0,0,43,42.556V41h1.385a.3.3,0,0,0,.328-.311V40.5a.3.3,0,0,0-.328-.317H43V39.05A.32.32,0,0,1,43,39.01Z" transform="translate(-33.1 -27.46)" fill="#fff"/>
            <g id="Order_pos" data-name="Order pos">
              <path id="Path_4772" data-name="Path 4772" d="M28.414,15.768h-5.18V36.637h2.711l-.863-.853-.014-.014-.013-.016a1.169,1.169,0,0,1-.219-.373H24.5V17.023h3.013v8.316h8.406V35.382h-.335a1.014,1.014,0,0,1-.25.377l-.892.878h2.747V24.452Zm.372,8.316V17.911l6.24,6.174Z" transform="translate(-23.234 -15.768)" fill="#fff"/>
            </g>
            <g id="Group_7294" data-name="Group 7294" transform="translate(2.463 15.394)">
              <path id="Path_4773" data-name="Path 4773" d="M30.677,52.222a.672.672,0,0,0-.482-.265.66.66,0,0,0-.379.15l-.23.217a.551.551,0,0,0-.21.411.61.61,0,0,0,.175.388l3.9,3.914a.521.521,0,0,0,.413.171.548.548,0,0,0,.437-.184l3.928-3.932a.531.531,0,0,0,.182-.371.537.537,0,0,0-.2-.4l-.262-.23a.516.516,0,0,0-.761.03c-1,1.037-1.812,1.876-2.4,2.5l-.21.22,0-.3c.011-1.484.011-1.408.011-4.886a.555.555,0,0,0-.567-.615h-.3a.547.547,0,0,0-.579.565l.009,5.218-.209-.226C32.4,54.011,31.641,53.214,30.677,52.222Z" transform="translate(-29.376 -49.038)" fill="#fff"/>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <button type="button" (click)="togglePdfPreview()" [ngStyle]="{'background-color': showPdfPreview ? 'var(--orange-dark)' : 'rgb(130, 167, 226)'}">
      {{ (showPdfPreview ? "Close Preview" : "Preview") | translate }}
    </button>

    <div class="container-pdf-preview cream-scroll">
      <app-deviation-pdf
        [formValues]="createForm.value"
        [project]="project"
        [nextDeviationNumber]="ata_messages[selectedDeviation].AtaNumber"
        [selectedDeviation]="selectedDeviation"
        [files]="files"
        [uploadedFiles]="ata_messages[selectedDeviation].attachments"
        [generalImage]="generalImage"
        (runParentFunction)="runParentFunction($event)"
        [clientResponses]="clientResponses"
        [internalDeviationChat]="ata_messages[selectedDeviation].internalDeviationChat"
        (totalPage)="updateTotalPageDeviationPdfPreview($event)"
        [mainContact]="mainContact"
        [type]="type"
      ></app-deviation-pdf>
    </div>
  </div>
</div>


<ng-template #otherComponent>
  <app-gallery
    *ngIf="swiper.images.length"
    [swiper]="swiper"
    [canRemove]="false"
    (removeImageEvent)="removeSwiperImage($event)"
    (closeSwiperEvent)="closeSwiper($event)"
    [server]="true"
  ></app-gallery>
</ng-template>
<ng-container *ngIf="isPDFViewer; else otherComponent">
  <app-pdfjs-viewer
    *ngIf="swiper.images.length"
    [swiper]="swiper"
    [canRemove]="false"
    [server]="true"
    (removeImageEvent)="removeSwiperImage($event)"
    (closeSwiperEvent)="closeSwiper()"
  ></app-pdfjs-viewer>
</ng-container>


<form [formGroup]="createForm">

      <!-- Start of the Deviation To Ata Modal -->
      <div
      class="modal fade ata-creaton-modal"
      id="confirmAtaCreationModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="confirmAtaCreationModalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-proper-flex" role="document">
        <div class="modal-content" style="height: 300px">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">
              ÄTA {{ "Payment type" | translate }}
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>


          <div class="modal-body">
            <div class="form-group">
              <label for="paymentType" class="required">{{
                "Please select payment type" | translate
              }}</label>

              <!--Dropdown Payment type-->
              <div class="input-wrapper2" >
                <app-simple-select
                [ClientItem]= "getDebitForms"
                [defaultValue]="{
                  id: '1',
                  Name: ''
                }"
                [fontSize]="18"
                #paymentType
                formControlName="DeviationPaymentType"
                [width]="302"
                [type1]="'PayType'"
                [disableSelect]="disabledInput"
                >
                </app-simple-select>
              </div>
            <!--End Dropdown Payment type-->
<!--
              <select
                class="project-nav-select form-control select-property toogle-enable select-arrow"
                id="paymentType"
                [ngClass]="{
                  'has-error':
                    (createForm.get('DeviationPaymentType').touched ||
                      myform.submitted) &&
                    createForm.get('DeviationPaymentType').invalid
                }"
                formControlName="DeviationPaymentType"
              >
              <ng-container *ngFor="let debitForm of getDebitForms">
                <option
                 *ngIf='debitForm.Id != 6'
                value="{{ debitForm.Id }}"
                >
                  {{ debitForm.Name }}
                </option>
              </ng-container>

              </select>
-->
              <span
                class="help-block"
                *ngIf="
                  (createForm.get('DeviationPaymentType').touched ||
                    myform.submitted) &&
                  createForm.get('DeviationPaymentType').invalid
                "
              >
                <span class="text-danger">
                  {{ "Please select payment type" | translate }}
                </span>
              </span>
            </div>
          </div>
          <div class="modal-footer">
            <div
              type="button"
              class="cancel-button"
              data-dismiss="modal"
              #articleCancelButton
            >
              {{ "Cancel" | translate }}
            </div>
            <div
              type="button"
              *ngIf="!createForm.get('DeviationPaymentType').invalid || !spinner"
              class="save-button"
              (click)="createAtaFromDeviation()"
            >
              {{ "Save" | translate }}
            </div>
            <span

              class="material-icons articles-icon icon-zindex"
              (click)="toggleRikiModal()"
              *ngIf="canAddArticlesToAta()"

            >
              article
            </span>
          </div>
          <div class="rikki-container">
            <app-articles-form

              [articlesMaterialProjectDeduct]="this.project['ata_charge_material']"
              [articlesOtherProjectDeduct]="this.project['ata_charge_ue']"
              *ngIf="rikiModalState"

            ></app-articles-form>
          </div>
        </div>
      </div>


    </div>
    <!-- End of the Deviation To Ata Modal -->
</form>

<img style="display: none;" src="assets/img/ata-icons/uncheck.svg" alt="">
<img style="display: none;"  src="assets/img/ata-icons/check.svg" alt="">
<img style="display: none;" src="/assets/img/modify-ata/check-orange.svg" >
<img style="display: none;" src="/assets/img/modify-ata/uncheck.svg" >
</div>
