<div class="tab-navigation mt-5">
    <div class="nav-tabs tab-navigation ">
        <ul class="nav nav-tabs nav-pills" role="tablist" >
            <li *ngIf="ensureDeviationExternalShow()" class="nav-item ">
                <a class="nav-link active" [ngClass]="{'active': selectedTab == 0, 'border-active': selectedTab == 0, 'border-inactive': selectedTab == 1 }" (click)="setSelectedTab(0)" id="approveItem">
                    {{'External Deviation' | translate}}
                    <div [ngClass]="{ 'hide-bottom-box-shadow': selectedTab== 0, 'bottom-shadow-button': selectedTab != 0 }"></div>
                </a>
            </li>
            <li *ngIf="ensureDeviationInternalShow()" class="nav-item align-l">
                <a class="nav-link attest" [ngClass]="{'active': selectedTab == 1, 'border-active': selectedTab == 1, 'border-inactive': selectedTab == 0}" (click)="setSelectedTab(1)">
                    {{'Internal Deviation' | translate}} <div [ngClass]="{ 'hide-bottom-box-shadow': selectedTab == 1 , 'bottom-shadow-button': selectedTab != 1 }"></div></a>
            </li>
        </ul>
    </div>

</div>
<div style="position: relative;">
    <div class="nav-wrapper underrattelse-border blu-scroll shadow-top-div"
    [ngStyle]="{ height: container_height }">
        <div style="width: 1392px;">
            <div class="input-wrapper">

                <div class="ata-search">
                    <span class="search-icon">
                        <svg  xmlns="http://www.w3.org/2000/svg" width="13" height="13.06" viewBox="0 0 13 13.06"><path  id="Path_737" data-name="Path 737" d="M30.923,28.9l-.078-.079h0l-3.134-3.151a5.185,5.185,0,0,0-4.425-7.777h-.034a5.18,5.18,0,0,0-.032,10.36h.034a5.106,5.106,0,0,0,2.595-.706l3.131,3.149h0l.078.079a.6.6,0,0,0,.858,0l1.007-1.013A.612.612,0,0,0,30.923,28.9Zm-7.695-1.968a3.859,3.859,0,0,1,.024-7.718h.026a3.8,3.8,0,0,1,2.707,1.148,3.874,3.874,0,0,1-.027,5.449,3.8,3.8,0,0,1-2.7,1.121Z" transform="translate(-18.101 -17.89)" fill="#fcf4ec"></path></svg>
                    </span>
                    <input type="text" class="form-control mt-2 search-input" id="searchInput" placeholder="{{'Search'|translate}}" #searchInput [(ngModel)]="searchQuery" style="width:250px;" (input)="onSearch(searchInput.value)" >
                    <span class="clear-icon" (click)="clearSearchText($event)" *ngIf="existString">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="10.189"
                            height="10.189"
                            viewBox="0 0 10.189 10.189"
                        >
                        <path
                            id="Path_783"
                            data-name="Path 783"
                            d="M.589.708-3.622,4.925l.873.883L1.473,1.59,5.694,5.807l.873-.883L2.346.708,6.567-3.5l-.884-.872L1.473-.165-2.749-4.382l-.873.883Z"
                            transform="translate(3.622 4.382)"
                            fill="#fcf4ec"
                        />
                        </svg>
                    </span>
                </div>
                <div class="ml-3 d-sm-flex flex-columnX mt-4">
                    <form class="buttons-form" style="justify-content: inherit">
                        <div class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('all')">
                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('all')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('all')" color='#ff7000'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'All' | translate }}</span></div>
                        </div>
                        <div class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('0')">
                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('0')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('0')" color='#f0e264'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'Under pricing' | translate }}</span></div>
                        </div>

                        <div class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('4')">

                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('4')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('4')" color='#94effd'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'Sent' | translate }}</span></div>
                        </div>
                        <div class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('2');  onStatusChange('9');">

                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('2')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('2')" color='#E3E9DD'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'TSC_ANSWERED' | translate }}</span></div>
                        </div>

                        <div *ngIf="selectedTab == 0" class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('1');">
                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('1')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('1')" color='#fd9a44'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'Question' | translate }}</span> </div>
                        </div>

                        <div *ngIf="selectedTab == 0" class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('3')">
                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('3')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('3')" color='white'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'Aborted' | translate }}</span></div>
                        </div>

                        <div *ngIf="selectedTab == 1" class="d-flex border-item p-1 mr-4 cursor-pointer" (click)="onStatusChange('3')">
                            <div class="margin-svg-buttons">
                                <app-not-selected-icon-svg *ngIf="!statusObjectCondition('3')"></app-not-selected-icon-svg>
                                <app-selected-icon-svg *ngIf="statusObjectCondition('3')" color='red'></app-selected-icon-svg>
                            </div>
                            <div class="align-button-title"><span class=" text-uppercase mr-1 ">{{ 'Not Current' | translate }}</span></div>
                        </div>
                    </form>
                </div>
                <div class="buttons-nw-pr" *ngIf="allowCreateDeviation()">
                    <div class="nav-links">

                        <a

                            class="btn ata-btn float-right mr-4 d-flex"
                            routerLinkActive="active"
                            [routerLink]="['/projects/view/deviation/new/', project.id]"
                            [queryParams]="{type: selectedTab, nextNumber: nextDeviationNumber, from: selectedTab == 1 ? 'internal' : 'external'}"
                            [hidden]="project.status == 3"
                            [routerLinkActiveOptions]="{exact: true}"

                        >
                            <app-new-ata-icon-svg color="#82a7e2"></app-new-ata-icon-svg>
                           <span class="mt-1 mr-2 " style="height: 21px;
                                                           margin-top: 2px!important;
                                                           margin-left: 15px!important;
                                                           white-space: nowrap;"

                        >{{'New Deviation' | translate}}</span>

                        </a>
                    </div>
                    <div style="margin-right: 5px;">
                        <div *ngIf="checkIfDataExist(selectedTab)" style="position: relative; z-index: 1000;" class="button-container">

                    <!-- Dropdown SEND/PRINT SUMM -->
                    <div class="input-wrapper4"  >
                      <app-samm-dropdown
                      [Samm] = "client_workers"
                      [placeholder]="'TSC_Summary' | translate"
                      [Print]="('Print' | translate) + ' ' + ('Deviation' | translate)"
                      [Export]="'Export Documents' | translate"
                      [Send]="'Send to' | translate"
                      [width]="185"
                      (PrintButton)="printSummary(selectedTab)"
                      (ExportButton)="sendExportedDocuments($event)"
                      (SendButton)="sendSummaryToClient($event, selectedTab)"
                      [HaveExport]="true"
                      [disableSelect]="false"
                      >
                      </app-samm-dropdown>
                    </div>
                  <!-- End Dropdown SEND/PRINT SUMM -->
<!--
                            <button [class.button-open]="buttonToggle" class="btn ata-btn-summary mr-4 d-flex" (click)="buttonNameSummary($event, worker)">
                                <div class="mt-1 ml-2 " style="text-align: left;">{{'TSC_Summary'|translate}}</div>

                            </button>

-->
                            <div class="summary-dropdown" [ngClass]="buttonToggle ? '' : 'd-none' ">
                                <div class="p-1 border-summary" (click)="printSummary(selectedTab)" (mouseenter)="onMouseEnter()" (mouseleave)="OnMouseLeave()">
                                    <div>
                                        <span class="mt-1 ml-2 fs-10">{{'Print'| translate}} {{ 'Deviation' | translate }}</span>
                                    </div>
                                    <div>
                                        <app-pdf-icon-svg [color]="color"></app-pdf-icon-svg>
                                    </div>
                                </div>

                                <div [ngClass]="contacts.length == 0 ? 'disabled-icon' : 'enabled-icon'" class="p-1"
                                style="border-bottom:1px solid var(--border-color);">
                                    <div class="text-icon-align">
                                        <div class="flex-justify" (click)="sendExportedDocuments()">
                                            <span class="mt-1 ml-2 fs-10">{{'Export Documents'|translate}}</span>
                                            <img src="../../../../assets/img/disabled-icon.svg" *ngIf="contacts.length == 0 || project.status != 3 && project.status != 4">
                                            <img src="../../../../assets/img/enabled-icon.svg" *ngIf="contacts.length > 0 && (project.status == 3 || project.status == 4)">
                                        </div>
                                        <div *ngIf="project.status == 3 || project.status == 4">
                                            <div class="workers d-flex pl-3 workers-border p-1" *ngFor="let worker of client_workers" (click)="buttonNameSummary($event, worker)">
                                                <span class="ml-1">{{ worker.Name }}</span>
                                                <span *ngIf="checkIfContactSelected(worker)==false">
                                                    <img style="padding: 0px 0px 0px 3px;" src="../../../../assets/img/uncheck.svg" alt="">
                                                </span>
                                                <span *ngIf="checkIfContactSelected(worker)">
                                                    <img style="padding: 0px 0px 0px 3px;" src="../../../../assets/img/check_orange.svg" alt="">
                                                </span>
                                            </div>
                                        </div>


                                    </div>
                                </div>

                                <div [ngClass]="contacts.length == 0 ? 'disabled-icon' : 'enabled-icon'" class="p-1">

                                        <div class="flex-justify" (click)="sendSummaryToClient(selectedTab)" >
                                            <span class="mt-1 ml-2 fs-10">{{'Send to'|translate}}</span>
                                            <img src="../../../../assets/img/disabled-icon.svg" *ngIf="contacts.length == 0 || project.status == 3 || project.status == 4">
                                            <img src="../../../../assets/img/enabled-icon.svg" *ngIf="contacts.length > 0 && (project.status != 3 && project.status != 4)">
                                        </div>
                                </div>

                                <div *ngIf="project.status != 3 && project.status != 4">
                                    <div class="workers d-flex pl-3 workers-border p-1" *ngFor="let worker of client_workers" (click)="buttonNameSummary($event, worker)">
                                        <span class="ml-1 fs-10">{{ worker.Name }}</span>
                                        <span *ngIf="checkIfContactSelected(worker)==false">
                                            <img style="padding: 0px 0px 0px 3px;" src="../../../../assets/img/uncheck.svg" alt="">
                                        </span>
                                        <span *ngIf="checkIfContactSelected(worker)">
                                            <img style="padding: 0px 0px 0px 3px;" src="../../../../assets/img/check_orange.svg" alt="">
                                        </span>
                                    </div>
                                </div>


                            </div>
                            <div *ngIf="buttonToggle" (click)="closeToggle()" class="toggle"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ata-border" *ngIf="selectedTab == 0">
                <div class="nav-wrapper">
                    <div>
                        <table style="position: relative; z-index: 100;">
                            <thead>
                                <tr>
                                    <th scope="col" class="number-width ">{{'Number' | translate}}<div  class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="name-extern-width">{{'Name' | translate}}<div class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="ata-width">{{'ÄTA' | translate}}<div  class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="int-dev-width">{{'Internal' | translate}} {{ 'U' | translate}}<div class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="type-width">
                                        <select class="deviation-nav-select select-th" id="typeata" (change)="filterByTypes(selectAtaType.value, 'external')" #selectAtaType>
                                            <option value="0">{{'Deviation type' | translate}}</option>
                                            <option *ngFor="let type of ActiveExternalDeviationTypes" value="{{type.id}}">
                                                {{type.Name}}</option>
                                        </select>
                                        <div  class="bottom-shadow-thead"></div>
                                    </th>
                                    <th scope="col" class="skickad-width">{{ 'Sent' | translate }} <div class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="skickad-width">{{ 'TSC_ANSWERED' | translate }}<div  class="bottom-shadow-thead"></div></th>
                                    <th scope="col" class="skickad-width">{{ 'Answered by' | translate }}<div class="bottom-shadow-thead"></div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngIf="externalDeviations.length < 1">
                                    <td colspan="6" class="text-center">{{'No deviations created yet'|translate}}</td>
                                </tr>
                                <tr *ngFor="let ata of getFilteredExternalDeviations; let index = index" [ngClass]="getDeviationStatusClass(ata.Status)" (click)="edit(ata, 'external')">
                                    <td>U-{{ata.DeviationNumber}}</td>
                                    <td><span>{{ata.Name}}</span> <strong class="ml-1">({{ata.Messages}})</strong></td>
                                    <td (click)="redirectTo($event, ata.AtaInternalNumber, ata.ExternalAtaNumber, ata.ataRelation, ata, 'ATA')">
                                        <a href="javascript:void(0)">{{ getRelationKey(ata.ataRelation, 'number', 'ATA', ata) }}</a>
                                    </td>
                                    <td (click)="redirectTo($event, ata.AtaInternalNumber, ata.ExternalAtaNumber, ata.deviationRelation, ata, 'DEVIATION')">
                                        <a href="javascript:void(0)">{{ getRelationKey(ata.deviationRelation, 'number', 'Deviation', ata) }}</a>
                                    </td>
                                    <td>{{ getDeviationType(ata.DeviationType) }}</td>
                                    <td>{{ printLastEmailLogDate(ata,'Date') }}</td>
                                    <td>{{ printLastEmailLogDate(ata,'Responded') }}</td>
                                    <td>{{ printDeviationStatusText(ata.Status) | translate }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



            <div *ngIf="selectedTab == 1">
                <div class="">
                    <table style="position: relative; z-index: 100;">
                        <thead>
                            <tr>
                                <th scope="col">{{'Nr' | translate}}<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col">{{'Name' | translate}}<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col">ÄTA<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col">{{ 'External' | translate }} U<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col" class="type-width">
                                    <select class="deviation-nav-select select-th" id="typeata" (change)="filterByTypes(selectAtaType.value, 'internal')" #selectAtaType>
                                        <option value="0">{{'Deviation type' | translate}}</option>
                                        <option *ngFor="let type of ActiveInternalDeviationTypes" value="{{type.id}}">
                                            {{type.Name}}</option>
                                    </select>
                                    <div  class="bottom-shadow-thead"></div>
                                </th>
                                <th scope="col" class="skickad-width">{{ 'Sent' | translate }}<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col" class="skickad-width">{{ 'TSC_ANSWERED' | translate }}<div  class="bottom-shadow-thead"></div></th>
                                <th scope="col">{{ 'Answered by' | translate }}<div  class="bottom-shadow-thead"></div> </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="internalDeviations.length < 1">
                                <td colspan="6" class="text-center">{{'No deviations created yet'|translate}}</td>
                            </tr>
                            <tr *ngFor="let ata of getFilteredInternalDeviations; let index = index" [ngClass]="getDeviationStatusClass(ata.Status)" (click)="edit(ata, 'internal')">
                                <td>U-{{ata.DeviationNumber}}</td>
                                <td><span>{{ata.Name}}</span> <strong class="ml-1">({{ata.Messages}})</strong></td>
                                <td (click)="redirectTo($event, ata.AtaInternalNumber, ata.ExternalAtaNumber, ata.ataRelation, ata, 'ATA')">
                                    <a href="javascript:void(0)">{{ getRelationKey(ata.ataRelation, 'number', 'ATA', ata) }}</a>
                                </td>
                                <td (click)="redirectTo($event, ata.AtaInternalNumber, ata.ExternalAtaNumber, ata.deviationRelation, ata, 'DEVIATION')">
                                    <a href="javascript:void(0)">{{ getRelationKey(ata.deviationRelation, 'number', 'Deviation', ata) }}</a>
                                </td>
                                <td>{{getDeviationType(ata.DeviationType)}}</td>
                                <td>{{ printLastChatDate(ata.lastChat, 'created_at') }}</td>
                                <td>{{ printLastChatDate(ata.lastChat, 'updated_at') }}</td>
                                <td>{{ printDeviationStatusTextInternal(ata) | translate }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <div class="ata-prognosis-border"></div>
        <div class="thin-prognosis-border-bottom"></div>
    </div>

    <div class="progress-loader" *ngIf="emailSending">
        <mat-spinner></mat-spinner>
    </div>
